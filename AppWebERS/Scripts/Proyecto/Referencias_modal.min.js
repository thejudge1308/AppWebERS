//Creador Patricio Quezada
//Archivo minificado
function init_option() { $("#referencia_modal .modal-body").empty(), $("#referencia_modal .modal-body").append(init_modal()), $("#referencia_modal .modal-footer").empty(), $("#referencia_modal .modal-footer").append('<button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>') } function book_option() { $("#referencia_modal .modal-body").empty(), $("#tittle_modal").text("Formulario libro"), $("#referencia_modal .modal-body").append(book_modal()), $("#referencia_modal .modal-footer").empty(), $("#referencia_modal .modal-footer").append('<button id="guardar_libro" type="button" class="btn btn-primary">Guardar</button><button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>') } function paper_option() { $("#referencia_modal .modal-body").empty(), $("#tittle_modal").text("Formulario revista."), $("#referencia_modal .modal-body").append(paper_modal()), $("#referencia_modal .modal-footer").empty(), $("#referencia_modal .modal-footer").append('<button id="guardar_paper" type="button" class="btn btn-primary">Guardar</button><button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>') } function paper_conf_option() { $("#referencia_modal .modal-body").empty(), $("#tittle_modal").text("Formulario revista."), $("#referencia_modal .modal-body").append(paper_conf_modal()), $("#referencia_modal .modal-footer").empty(), $("#referencia_modal .modal-footer").append('<button id="guardar_paper_conf" type="button" class="btn btn-primary">Guardar</button><button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>') } function init_modal() { return '<div class="container-fluid"><div class="row"><div class="col-md-12 m-2"><button id="book-button" type="button" style="width:100%" class="btn btn-primary">Libro.</button></div></div ><div class="row"><div class="col-md-12 m-2"><button id="paper-button" type="button" style="width:100%" class="btn btn-primary">Paper</button></div></div><div class="row"><div class="col-md-12 m-2"><button id="conferencia-button" type="button" style="width:100%" class="btn btn-primary">Paper de conferencia.</button></div></div></div ></div >' } function book_modal() { return html = '<div class="container-fluid"><div class="row"><div class="col-md-12 col-sm-12 col-xs-12"><div class="form-group"><label class="control-label"> Autores. </label><input class="form-control" style="max-width: 100%;" id="autores-box" type="text" /></div><div class="form-group"><label class="control-label"> Año de publicación. </label><input class="form-control" style="max-width: 100%;" id="anio-box" type="number" /></div><div class="form-group"><label class="control-label"> Título del libro. </label><input class="form-control" style="max-width: 100%;" id="titulo-box" type="text" /></div><div class="form-group"><label class="control-label " for="name"> Páginas. </label><input class="form-control" style="max-width: 100%;" id="lugar-box" type="text" /></div><div class="form-group"><label class="control-label " for="name"> Editorial. </label><input class="form-control" style="max-width: 100%;" id="editorial-box" type="text" /></div><div class="form-group"><label id="mensaje" class="control-label text-danger"></label></div></div></div></div >', html } function paper_modal() { return html = '<div class="container-fluid"><div class="row"><div class="col-md-12 col-sm-12 col-xs-12"><div class="form-group"><label class="control-label" for="name"> Autores. </label><input class="form-control" style="max-width: 100%;" id="autores-box" type="text" /></div><div class="form-group"><label class="control-label" for="name"> Año de publicación. </label><input class="form-control" style="max-width: 100%;" id="anio-box" type="number" /></div><div class="form-group"><label class="control-label " for="name"> Título del libro. </label><input class="form-control" style="max-width: 100%;" id="titulo-box" type="text" /></div><div class="form-group"><label class="control-label " for="name"> Nombre de la revista. </label><input class="form-control" style="max-width: 100%;" id="nombre-box" type="text" /></div><div class="form-group"><label class="control-label " for="name"> Volumen. </label><input class="form-control" style="max-width: 100%;" id="vol-box" type="text" /></div><div class="form-group"><label class="control-label " for="name"> Páginas. </label><input class="form-control" style="max-width: 100%;" id="pag-box" type="text" /></div><div class="form-group"><label id="mensaje" class="control-label text-danger"></label></div></div></div></div >', html } function paper_conf_modal() { return html = '<div class="container-fluid"><div class="row"><div class="col-md-12 col-sm-12 col-xs-12"><div class="form-group"><label class="control-label" for="name"> Autores. </label><input class="form-control" style="max-width: 100%;" id="autores-box" type="text" /></div><div class="form-group"><label class="control-label" for="name"> Año de publicación. </label><input class="form-control" style="max-width: 100%;" id="anio-box" type="number" /></div><div class="form-group"><label class="control-label " for="name"> Título del paper. </label><input class="form-control" style="max-width: 100%;" id="titulo-box" type="text" /></div><div class="form-group"><label class="control-label " for="name"> Lugar de presentación. </label><input class="form-control" style="max-width: 100%;" id="place-box" type="text" /></div><div class="form-group"><label class="control-label " for="name"> Nombre de la conferencia. </label><input class="form-control" style="max-width: 100%;" id="nomconf-box" type="text" /></div><div class="form-group"><label id="mensaje" class="control-label text-danger"></label></div></div></div></div >', html } function agregarFila(o) { return html = '<tr><td class="mesaje"><span>' + o + '</span></td><td class="text-right"><a class="btn btn-danger text-white" id="boton_fila" >Eliminar</a></td></tr>', html } function filaVacia() { return html = '<tr class="table-info not-found"><td ><br>No hay referencias.<br></td><td></td></tr>', html } function getReferencias() { var o = "/Proyecto/MostrarReferencia/" + $("#ProyectoActual_IdProyecto").val(); $.get(o, function () { }).done(function (o) { "null" == o ? $("#referencia_table").find("tbody:last").append(filaVacia()) : (console.log(o), $.each(o, function (o, a) { console.log(a.valor), $("#referencia_table").find("tbody:last .not-found").remove(), $("#referencia_table").find("tbody:last").append(agregarFila(a.valor)) })) }).fail(function () { }).always(function () { }) } function guardarLibro(o, a, t, e, r, l) { var n = { id: o, autores: a, anio: t, titulo: e, lugar: r, editorial: l }; console.log(n), $.ajax({ type: "POST", url: "/Proyecto/AgregarReferenciaLibro", data: JSON.stringify(n), contentType: "application/json; charset=utf-8", dataType: "json", success: function (o) { console.log(o), o ? (mostrarAlerta("Agregado con éxito"), $("#referencia_modal").modal("toggle"), $("#referencia_table tbody").empty(), getReferencias()) : mostrarAlerta("No se ha podido guardar la referencia.") }, failure: function (o) { mostrarAlerta(o.responseText) }, error: function (o) { mostrarAlerta(o.responseText) } }) } function guardarRevista(o, a, t, e, r, l, n) { var i = { id: o, autores: a, fecha: t, titulo: e, revista: r, volumen: l, pag: n }; $.ajax({ type: "POST", url: "/Proyecto/AgregarReferenciaPaper", data: JSON.stringify(i), contentType: "application/json; charset=utf-8", dataType: "json", success: function (o) { console.log(o), o ? (mostrarAlerta("Agregado con éxito"), $("#referencia_modal").modal("toggle"), $("#referencia_table tbody").empty(), getReferencias()) : mostrarAlerta("No se ha podido guardar la referencia.") }, failure: function (o) { mostrarAlerta(o.responseText) }, error: function (o) { mostrarAlerta(o.responseText) } }) } function guardarReferencia(o, a, t, e, r, l) { var n = { id: o, autores: a, fecha: t, titulo: e, lugar: r, nombre_conferencia: l }; $.ajax({ type: "POST", url: "/Proyecto/AgregarReferenciaConferencia", data: JSON.stringify(n), contentType: "application/json; charset=utf-8", dataType: "json", success: function (o) { console.log(o), o ? (mostrarAlerta("Agregado con éxito"), $("#referencia_modal").modal("toggle"), $("#referencia_table tbody").empty(), getReferencias()) : mostrarAlerta("No se ha podido guardar la referencia.") }, failure: function (o) { mostrarAlerta(o.responseText) }, error: function (o) { mostrarAlerta(o.responseText) } }) } function fecha_event() { $("#anio-box").change(function () { $(this).val() < 1 ? $(this).val(1) : 3e3 < $(this).val() && $(this).val(3e3) }) } $(document).ready(function () { getReferencias() }), $("#ejemplo_m").click(function () { init_option(), $("#referencia_modal").modal() }), $("#addref").on("click", function () { init_option(), $("#referencia_modal").modal() }), $("#referencia_modal .modal-body").on("click", "#book-button", function () { book_option(), fecha_event() }), $("#referencia_modal .modal-body").on("click", "#paper-button", function () { paper_option(), fecha_event() }), $("#referencia_modal .modal-body").on("click", "#conferencia-button", function () { paper_conf_option(), fecha_event() }), $("#referencia_modal .modal-footer").on("click", "#guardar_libro", function () { $("#mensaje").text(""), "" == $.trim($("#autores-box").val()) || "" == $.trim($("#anio-box").val()) || "" == $.trim($("#titulo-box").val()) || "" == $.trim($("#lugar-box").val()) || "" == $.trim($("#editorial-box").val()) ? $("#mensaje").text("Ingrese todos los datos.") : guardarLibro($("#ProyectoActual_IdProyecto").val(), $.trim($("#autores-box").val()), $.trim($("#anio-box").val()), $.trim($("#titulo-box").val()), $.trim($("#lugar-box").val()), $.trim($("#editorial-box").val())) }), $("#referencia_modal .modal-footer").on("click", "#guardar_paper", function () { $("#mensaje").text(""), "" == $.trim($("#autores-box").val()) || "" == $.trim($("#anio-box").val()) || "" == $.trim($("#titulo-box").val()) || "" == $.trim($("#nombre-box").val()) || "" == $.trim($("#vol-box").val()) || "" == $.trim($("#pag-box").val()) ? $("#mensaje").text("Ingrese todos los datos.") : guardarRevista($("#ProyectoActual_IdProyecto").val(), $.trim($("#autores-box").val()), $.trim($("#anio-box").val()), $.trim($("#titulo-box").val()), $.trim($("#nombre-box").val()), $.trim($("#vol-box").val()), $.trim($("#pag-box").val())) }), $("#referencia_modal .modal-footer").on("click", "#guardar_paper_conf", function () { $("#mensaje").text(""), "" == $.trim($("#autores-box").val()) || "" == $.trim($("#anio-box").val()) || "" == $.trim($("#titulo-box").val()) || "" == $.trim($("#place-box").val()) || "" == $.trim($("#nomconf-box").val()) ? $("#mensaje").text("Ingrese todos los datos.") : guardarReferencia($("#ProyectoActual_IdProyecto").val(), $.trim($("#autores-box").val()), $.trim($("#anio-box").val()), $.trim($("#titulo-box").val()), $.trim($("#place-box").val()), $.trim($("#nomconf-box").val())) }), $("#referencia_table").on("click", "#boton_fila", function () { var a = $(this).parent().parent(), o = a.find("span").text(), t = { id: $("#ProyectoActual_IdProyecto").val(), valor: o }; $.ajax({ type: "POST", url: "/Proyecto/RemoverReferenciaPaper", data: JSON.stringify(t), contentType: "application/json; charset=utf-8", dataType: "json", success: function (o) { console.log(o), o ? (mostrarAlerta("Eliminado con éxito"), a.remove(), 1 == $("#referencia_table tr").length && $("#referencia_table").find("tbody:last").append(filaVacia())) : mostrarAlerta("No se ha podido eliminar la referencia.") }, failure: function (o) { mostrarAlerta(o.responseText) }, error: function (o) { mostrarAlerta(o.responseText) } }) });